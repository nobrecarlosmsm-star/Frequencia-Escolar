<!DOCTYPE html>
<html lang="pt-BR">
<head>A
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frequ√™ncia Escolar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- jsPDF para gera√ß√£o de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        @media print { .no-print { display: none !important; } }
        .header-gradient { background: linear-gradient(135deg, #5b5fc7 0%, #7c4dff 100%); }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .toast { animation: slideIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const DEFAULT_USERS = { admin: { password: 'admin123', role: 'admin', name: 'Administrador Principal' } };
        const STUDENT_STATUS = { ATIVO: 'ativo', TRANSFERIDO: 'transferido', FALECIDO: 'falecido' };
        const ATTENDANCE_STATUS = { PRESENTE: 'presente', FALTA: 'falta', JUSTIFICADA: 'justificada' };
        const API_URL = 'https://api.jsonbin.io/v3';
        
        // CONFIGURA√á√ÉO CENTRAL - Edite aqui sua chave da API e BIN ID
        const SHARED_CONFIG = {
            apiKey: '$2a$10$LVhD8Cj/YDHnZ.LAXI5.Le3VqZCMWJ0BXMs8konXq0FsxfdfRarOe', // Cole sua chave da API aqui (s√≥ precisa configurar UMA VEZ)
            binId: '698dac12d0ea881f40b4991f'   // Cole seu BIN ID aqui (gerado automaticamente na primeira sincroniza√ß√£o)
        };
        
        // Toast notification component
        function Toast({ message, type = 'success', onClose }) {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, []);
            
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            
            return (
                <div className={`fixed top-4 right-4 ${bgColor} text-white px-6 py-4 rounded-lg shadow-2xl z-50 toast flex items-center gap-3`}>
                    <span className="text-2xl">{icon}</span>
                    <span className="font-semibold">{message}</span>
                </div>
            );
        }
        
        class CloudSync {
            static getKey() { 
                return SHARED_CONFIG.apiKey || localStorage.getItem('jsonbin_api_key') || ''; 
            }
            
            static getBinId() {
                return SHARED_CONFIG.binId || localStorage.getItem('syncBinId') || '';
            }
            
            static async checkConnection() {
                try {
                    const response = await fetch('https://www.google.com/favicon.ico', { 
                        mode: 'no-cors',
                        cache: 'no-cache'
                    });
                    return true;
                } catch {
                    return false;
                }
            }
            
            static async save(data) {
                const key = this.getKey();
                if (!key) return { success: false, error: 'Chave da API n√£o configurada' };
                
                const isOnline = await this.checkConnection();
                if (!isOnline) return { success: false, error: 'Sem conex√£o com a internet' };
                
                try {
                    const binId = this.getBinId();
                    const url = binId ? `${API_URL}/b/${binId}` : `${API_URL}/b`;
                    const res = await fetch(url, {
                        method: binId ? 'PUT' : 'POST',
                        headers: { 'Content-Type': 'application/json', 'X-Master-Key': key },
                        body: JSON.stringify({ ...data, lastSync: new Date().toISOString() })
                    });
                    if (!res.ok) throw new Error('Erro na sincroniza√ß√£o');
                    const result = await res.json();
                    if (result.metadata?.id && !SHARED_CONFIG.binId) {
                        localStorage.setItem('syncBinId', result.metadata.id);
                        console.log('üîë IMPORTANTE: Adicione este BIN ID no c√≥digo:');
                        console.log('binId: "' + result.metadata.id + '"');
                    }
                    return { success: true, binId: result.metadata?.id };
                } catch (error) { 
                    return { success: false, error: error.message }; 
                }
            }
            
            static async load() {
                const key = this.getKey();
                const binId = this.getBinId();
                if (!key || !binId) return null;
                
                const isOnline = await this.checkConnection();
                if (!isOnline) return null;
                
                try {
                    const res = await fetch(`${API_URL}/b/${binId}/latest`, {
                        headers: { 'X-Master-Key': key }
                    });
                    if (!res.ok) return null;
                    const result = await res.json();
                    return result.record;
                } catch { return null; }
            }
        }
        
        function App() {
            const [user, setUser] = useState(null);
            const [users, setUsers] = useState(DEFAULT_USERS);
            const [classes, setClasses] = useState([]);
            const [selectedClass, setSelectedClass] = useState(null);
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showConfig, setShowConfig] = useState(false);
            const [showUsers, setShowUsers] = useState(false);
            const [showClasses, setShowClasses] = useState(false);
            const [showStudents, setShowStudents] = useState(false);
            const [syncing, setSyncing] = useState(false);
            const [lastSync, setLastSync] = useState(null);
            const [toast, setToast] = useState(null);
            const [isOnline, setIsOnline] = useState(true);
            
            useEffect(() => { loadData(); checkOnlineStatus(); }, []);
            useEffect(() => {
                if (!user) return;
                const interval = setInterval(() => autoSync(), 15000);
                return () => clearInterval(interval);
            }, [user, classes, users]);
            
            const checkOnlineStatus = async () => {
                const online = await CloudSync.checkConnection();
                setIsOnline(online);
            };
            
            const showToast = (message, type = 'success') => {
                setToast({ message, type });
            };
            
            const loadData = async () => {
                const cloud = await CloudSync.load();
                if (cloud) {
                    setClasses(cloud.classes || []);
                    setUsers(cloud.users || DEFAULT_USERS);
                    setLastSync(cloud.lastSync);
                }
            };
            
            const autoSync = async () => {
                if (!CloudSync.getKey()) return;
                const result = await CloudSync.save({ classes, users });
                if (result.success) {
                    setLastSync(new Date().toISOString());
                    setIsOnline(true);
                } else {
                    setIsOnline(false);
                }
            };
            
            // Sincroniza sempre que houver mudan√ßas nos usu√°rios ou turmas
            useEffect(() => {
                if (user && CloudSync.getKey()) {
                    const syncTimer = setTimeout(() => {
                        autoSync();
                    }, 2000); // Sincroniza 2 segundos ap√≥s mudan√ßa
                    return () => clearTimeout(syncTimer);
                }
            }, [users, classes]);
            
            const manualSync = async () => {
                setSyncing(true);
                await checkOnlineStatus();
                
                if (!isOnline) {
                    showToast('Sem conex√£o com a internet!', 'error');
                    setSyncing(false);
                    return;
                }
                
                if (!CloudSync.getKey()) {
                    showToast('Configure a chave da API primeiro!', 'error');
                    setSyncing(false);
                    return;
                }
                
                const result = await CloudSync.save({ classes, users });
                
                if (result.success) {
                    setLastSync(new Date().toISOString());
                    if (result.binId && !SHARED_CONFIG.binId) {
                        showToast('‚úÖ Sincronizado! IMPORTANTE: Veja o console para o BIN ID', 'success');
                        alert(`üîë IMPORTANTE!\n\nSeu BIN ID foi gerado:\n${result.binId}\n\n1. Abra o arquivo HTML em um editor\n2. Encontre SHARED_CONFIG\n3. Cole este ID em binId: '${result.binId}'\n4. Salve e compartilhe o arquivo!\n\nAssim todos acessar√£o os mesmos dados!`);
                    } else {
                        showToast('Dados sincronizados com sucesso!', 'success');
                    }
                } else {
                    showToast(`Erro na sincroniza√ß√£o: ${result.error}`, 'error');
                }
                
                setTimeout(() => setSyncing(false), 1000);
            };
            
            const handleLogin = async (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                const login = fd.get('login');
                const pass = fd.get('password');
                
                // Verifica conex√£o
                await checkOnlineStatus();
                
                // Se tem chave da API, SEMPRE tenta carregar dados da nuvem primeiro
                if (CloudSync.getKey()) {
                    if (!isOnline) {
                        showToast('Sem conex√£o com a internet! √â necess√°rio estar online para fazer login.', 'error');
                        return;
                    }
                    
                    // Carrega dados atualizados da nuvem ANTES de verificar login
                    const cloudData = await CloudSync.load();
                    if (cloudData) {
                        // Atualiza os usu√°rios com os dados da nuvem
                        const cloudUsers = cloudData.users || DEFAULT_USERS;
                        
                        // Verifica login com os dados da nuvem
                        const u = cloudUsers[login];
                        if (u && u.password === pass) {
                            // Atualiza o estado com todos os dados da nuvem
                            setUsers(cloudUsers);
                            setClasses(cloudData.classes || []);
                            setLastSync(cloudData.lastSync);
                            
                            setUser({ 
                                login, 
                                ...u, 
                                canEdit: u.role === 'admin' || u.role === 'editor',
                                canManage: u.role === 'admin'
                            });
                            showToast(`Bem-vindo, ${u.name}!`, 'success');
                        } else {
                            showToast('Login ou senha incorretos!', 'error');
                        }
                    } else {
                        // Se n√£o conseguiu carregar da nuvem, tenta com dados locais
                        const u = users[login];
                        if (u && u.password === pass) {
                            setUser({ 
                                login, 
                                ...u, 
                                canEdit: u.role === 'admin' || u.role === 'editor',
                                canManage: u.role === 'admin'
                            });
                            showToast(`Bem-vindo, ${u.name}!`, 'success');
                        } else {
                            showToast('N√£o foi poss√≠vel carregar os dados da nuvem. Verifique sua chave da API.', 'error');
                        }
                    }
                } else {
                    // Sem chave da API, usa apenas dados locais
                    const u = users[login];
                    if (u && u.password === pass) {
                        setUser({ 
                            login, 
                            ...u, 
                            canEdit: u.role === 'admin' || u.role === 'editor',
                            canManage: u.role === 'admin'
                        });
                        showToast(`Bem-vindo, ${u.name}!`, 'success');
                    } else {
                        showToast('Login ou senha incorretos!', 'error');
                    }
                }
            };
            
            if (!user) {
                return (
                    <>
                        {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                        <div className="min-h-screen header-gradient flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                                <div className="text-center mb-8">
                                    <h1 className="text-4xl font-bold text-indigo-600 mb-2">üìö Frequ√™ncia Escolar</h1>
                                    <p className="text-gray-600">Sistema de Controle de Frequ√™ncia</p>
                                    {!isOnline && (
                                        <div className="mt-4 bg-red-100 text-red-700 px-4 py-2 rounded-lg text-sm">
                                            ‚ö†Ô∏è Sem conex√£o com a internet
                                        </div>
                                    )}
                                </div>
                                <form onSubmit={handleLogin} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">üë§ Login</label>
                                        <input name="login" className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 outline-none" required />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">üîí Senha</label>
                                        <input name="password" type="password" className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 outline-none" required />
                                    </div>
                                    <button type="submit" className="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition">
                                        ENTRAR
                                    </button>
                                </form>
                            </div>
                        </div>
                    </>
                );
            }
            
            const cls = classes.find(c => c.id === selectedClass);
            
            return (
                <div className="min-h-screen">
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                    
                    <div className="header-gradient text-white p-6 shadow-lg no-print">
                        <div className="max-w-7xl mx-auto">
                            <div className="flex items-center justify-between mb-4">
                                <div>
                                    <h1 className="text-3xl font-bold">üìö Frequ√™ncia Escolar</h1>
                                    <p className="text-indigo-200 mt-1">üë§ {user.name} ({user.role === 'admin' ? 'Administrador' : user.role === 'editor' ? 'Editor' : 'Visualizador'})</p>
                                </div>
                                <div className="flex gap-3 items-center">
                                    {!isOnline && (
                                        <div className="bg-red-500 px-4 py-2 rounded-lg text-sm font-semibold">
                                            ‚ö†Ô∏è Offline
                                        </div>
                                    )}
                                    {lastSync && (
                                        <div className="text-sm bg-white bg-opacity-20 px-4 py-2 rounded-lg">
                                            üì° √öltima sync: {new Date(lastSync).toLocaleString('pt-BR')}
                                        </div>
                                    )}
                                    <button onClick={manualSync} disabled={syncing}
                                        className="bg-white text-indigo-600 px-6 py-2 rounded-lg font-bold hover:bg-indigo-50 transition disabled:opacity-50 flex items-center gap-2">
                                        {syncing ? <span className="animate-spin">‚ü≥</span> : 'üîÑ'} Sincronizar
                                    </button>
                                    {user.canManage && (
                                        <button onClick={() => setShowConfig(true)}
                                            className="bg-white text-indigo-600 px-6 py-2 rounded-lg font-bold hover:bg-indigo-50 transition">
                                            ‚öôÔ∏è Configurar
                                        </button>
                                    )}
                                    <button onClick={() => setUser(null)}
                                        className="bg-red-500 px-6 py-2 rounded-lg font-bold hover:bg-red-600 transition">
                                        üö™ Sair
                                    </button>
                                </div>
                            </div>
                            
                            <div className="flex gap-2">
                                <button onClick={() => setActiveTab('dashboard')}
                                    className={`px-6 py-3 rounded-lg font-bold transition ${activeTab === 'dashboard' ? 'bg-white text-indigo-600' : 'bg-indigo-500 hover:bg-indigo-400'}`}>
                                    üìä Dashboard
                                </button>
                                <button onClick={() => setActiveTab('frequency')}
                                    className={`px-6 py-3 rounded-lg font-bold transition ${activeTab === 'frequency' ? 'bg-white text-indigo-600' : 'bg-indigo-500 hover:bg-indigo-400'}`}>
                                    ‚úÖ Frequ√™ncia
                                </button>
                                <button onClick={() => setActiveTab('reports')}
                                    className={`px-6 py-3 rounded-lg font-bold transition ${activeTab === 'reports' ? 'bg-white text-indigo-600' : 'bg-indigo-500 hover:bg-indigo-400'}`}>
                                    üìà Relat√≥rios
                                </button>
                                {user.canManage && (
                                    <>
                                        <button onClick={() => setShowClasses(true)}
                                            className="bg-green-500 px-6 py-3 rounded-lg font-bold hover:bg-green-400 transition">
                                            üè´ Turmas
                                        </button>
                                        <button onClick={() => setShowUsers(true)}
                                            className="bg-yellow-500 px-6 py-3 rounded-lg font-bold hover:bg-yellow-400 transition">
                                            üë• Usu√°rios
                                        </button>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                    
                    <div className="max-w-7xl mx-auto p-6">
                        {activeTab === 'dashboard' && <Dashboard classes={classes} />}
                        {activeTab === 'frequency' && <Frequency classes={classes} setClasses={setClasses} selectedClass={selectedClass} setSelectedClass={setSelectedClass} selectedDate={selectedDate} setSelectedDate={setSelectedDate} canEdit={user.canEdit} setShowStudents={setShowStudents} showToast={showToast} />}
                        {activeTab === 'reports' && <Reports classes={classes} showToast={showToast} />}
                    </div>
                    
                    {showConfig && <ConfigModal onClose={() => setShowConfig(false)} showToast={showToast} />}
                    {showUsers && <UsersModal users={users} setUsers={setUsers} onClose={() => setShowUsers(false)} showToast={showToast} />}
                    {showClasses && <ClassesModal classes={classes} setClasses={setClasses} onClose={() => setShowClasses(false)} showToast={showToast} />}
                    {showStudents && cls && <StudentsModal class={cls} classes={classes} setClasses={setClasses} onClose={() => setShowStudents(false)} showToast={showToast} />}
                </div>
            );
        }
        
        function Dashboard({ classes }) {
            const totalStudents = classes.reduce((sum, c) => sum + c.students.filter(s => s.status === 'ativo').length, 0);
            const today = new Date().toISOString().split('T')[0];
            
            let totalPresent = 0, totalAbsent = 0, totalJustified = 0;
            classes.forEach(c => {
                c.students.filter(s => s.status === 'ativo').forEach(s => {
                    const att = s.attendance?.[today];
                    if (att === 'presente') totalPresent++;
                    else if (att === 'falta') totalAbsent++;
                    else if (att === 'justificada') totalJustified++;
                });
            });
            
            return (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div className="bg-white p-6 rounded-xl shadow-lg border-l-4 border-indigo-500">
                        <div className="text-3xl mb-2">üè´</div>
                        <div className="text-gray-600 text-sm mb-1">Total de Turmas</div>
                        <div className="text-3xl font-bold text-indigo-600">{classes.length}</div>
                    </div>
                    
                    <div className="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-500">
                        <div className="text-3xl mb-2">üë®‚Äçüéì</div>
                        <div className="text-gray-600 text-sm mb-1">Alunos Ativos</div>
                        <div className="text-3xl font-bold text-blue-600">{totalStudents}</div>
                    </div>
                    
                    <div className="bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500">
                        <div className="text-3xl mb-2">‚úÖ</div>
                        <div className="text-gray-600 text-sm mb-1">Presentes Hoje</div>
                        <div className="text-3xl font-bold text-green-600">{totalPresent}</div>
                    </div>
                    
                    <div className="bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-500">
                        <div className="text-3xl mb-2">‚ùå</div>
                        <div className="text-gray-600 text-sm mb-1">Faltas Hoje</div>
                        <div className="text-3xl font-bold text-red-600">{totalAbsent}</div>
                    </div>
                    
                    <div className="col-span-full bg-white p-6 rounded-xl shadow-lg">
                        <h3 className="text-xl font-bold mb-4">üìä Vis√£o Geral das Turmas</h3>
                        <div className="space-y-3">
                            {classes.map(c => {
                                const activeStudents = c.students.filter(s => s.status === 'ativo');
                                const present = activeStudents.filter(s => s.attendance?.[today] === 'presente').length;
                                const percentage = activeStudents.length > 0 ? ((present / activeStudents.length) * 100).toFixed(0) : 0;
                                
                                return (
                                    <div key={c.id} className="border-2 rounded-lg p-4">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="font-bold text-lg">{c.name}</span>
                                            <span className="text-sm text-gray-600">{activeStudents.length} aluno(s) ativo(s)</span>
                                        </div>
                                        <div className="bg-gray-200 rounded-full h-4 overflow-hidden">
                                            <div className="bg-green-500 h-full transition-all" style={{ width: `${percentage}%` }}></div>
                                        </div>
                                        <div className="text-sm text-gray-600 mt-1">{percentage}% de presen√ßa hoje</div>
                                    </div>
                                );
                            })}
                            {classes.length === 0 && (
                                <p className="text-gray-500 text-center py-8">Nenhuma turma cadastrada ainda</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        }
        
        function Frequency({ classes, setClasses, selectedClass, setSelectedClass, selectedDate, setSelectedDate, canEdit, setShowStudents, showToast }) {
            const cls = classes.find(c => c.id === selectedClass);
            
            const handleAttendance = (studentId, status) => {
                if (!canEdit) return;
                setClasses(classes.map(c => 
                    c.id === selectedClass
                        ? {
                            ...c,
                            students: c.students.map(s =>
                                s.id === studentId
                                    ? { ...s, attendance: { ...s.attendance, [selectedDate]: status } }
                                    : s
                            )
                        }
                        : c
                ));
            };
            
            const handleObservation = (studentId, obs) => {
                if (!canEdit) return;
                setClasses(classes.map(c =>
                    c.id === selectedClass
                        ? {
                            ...c,
                            students: c.students.map(s =>
                                s.id === studentId
                                    ? { ...s, observations: { ...s.observations, [selectedDate]: obs } }
                                    : s
                            )
                        }
                        : c
                ));
            };
            
            return (
                <div className="space-y-6">
                    <div className="bg-white p-6 rounded-xl shadow-lg">
                        <h2 className="text-2xl font-bold mb-4">‚úÖ Controle de Frequ√™ncia</h2>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">üè´ Selecione a Turma:</label>
                                <select value={selectedClass || ''} onChange={(e) => setSelectedClass(Number(e.target.value))}
                                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-indigo-500 outline-none">
                                    <option value="">-- Escolha uma turma --</option>
                                    {classes.map(c => (
                                        <option key={c.id} value={c.id}>{c.name}</option>
                                    ))}
                                </select>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">üìÖ Data:</label>
                                <input type="date" value={selectedDate} onChange={(e) => setSelectedDate(e.target.value)}
                                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-indigo-500 outline-none" />
                            </div>
                        </div>
                        
                        {cls && (
                            <div className="flex justify-end mb-4">
                                <button onClick={() => setShowStudents(true)}
                                    className="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 transition">
                                    üë®‚Äçüéì Gerenciar Alunos
                                </button>
                            </div>
                        )}
                    </div>
                    
                    {cls ? (
                        <div className="bg-white p-6 rounded-xl shadow-lg">
                            <h3 className="text-xl font-bold mb-4">üë• Lista de Chamada - {cls.name}</h3>
                            <p className="text-sm text-gray-600 mb-4">üìÖ {new Date(selectedDate + 'T00:00:00').toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                            
                            {cls.students.filter(s => s.status === 'ativo').length === 0 ? (
                                <p className="text-gray-500 text-center py-8">Nenhum aluno ativo nesta turma</p>
                            ) : (
                                <div className="space-y-3">
                                    {cls.students.filter(s => s.status === 'ativo').map((student, idx) => (
                                        <div key={student.id} className="border-2 rounded-lg p-4 hover:bg-gray-50 transition">
                                            <div className="flex items-center gap-4 mb-3">
                                                <span className="font-bold text-lg bg-indigo-100 w-10 h-10 rounded-full flex items-center justify-center">
                                                    {idx + 1}
                                                </span>
                                                <span className="flex-1 font-bold text-lg">{student.name}</span>
                                                
                                                <div className="flex gap-2">
                                                    <button onClick={() => handleAttendance(student.id, 'presente')} disabled={!canEdit}
                                                        className={`px-6 py-2 rounded-lg font-bold transition ${student.attendance?.[selectedDate] === 'presente' ? 'bg-green-600 text-white' : 'bg-gray-200 hover:bg-green-100'} ${!canEdit && 'opacity-50 cursor-not-allowed'}`}>
                                                        ‚úÖ Presente
                                                    </button>
                                                    <button onClick={() => handleAttendance(student.id, 'falta')} disabled={!canEdit}
                                                        className={`px-6 py-2 rounded-lg font-bold transition ${student.attendance?.[selectedDate] === 'falta' ? 'bg-red-600 text-white' : 'bg-gray-200 hover:bg-red-100'} ${!canEdit && 'opacity-50 cursor-not-allowed'}`}>
                                                        ‚ùå Falta
                                                    </button>
                                                    <button onClick={() => handleAttendance(student.id, 'justificada')} disabled={!canEdit}
                                                        className={`px-6 py-2 rounded-lg font-bold transition ${student.attendance?.[selectedDate] === 'justificada' ? 'bg-yellow-600 text-white' : 'bg-gray-200 hover:bg-yellow-100'} ${!canEdit && 'opacity-50 cursor-not-allowed'}`}>
                                                        üìù Justificada
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-1">üìù Observa√ß√µes:</label>
                                                <textarea value={student.observations?.[selectedDate] || ''} 
                                                    onChange={(e) => handleObservation(student.id, e.target.value)}
                                                    disabled={!canEdit}
                                                    placeholder="Adicione observa√ß√µes sobre o aluno..."
                                                    className="w-full px-3 py-2 border-2 rounded-lg focus:border-indigo-500 outline-none resize-none" 
                                                    rows="2"></textarea>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    ) : (
                        <div className="bg-white p-12 rounded-xl shadow-lg text-center">
                            <div className="text-6xl mb-4">üè´</div>
                            <p className="text-xl text-gray-600">Selecione uma turma para come√ßar</p>
                        </div>
                    )}
                </div>
            );
        }
        
        function Reports({ classes, showToast }) {
            const [selectedClass, setSelectedClass] = useState(null);
            const [startDate, setStartDate] = useState(new Date(new Date().setDate(1)).toISOString().split('T')[0]);
            const [endDate, setEndDate] = useState(new Date().toISOString().split('T')[0]);
            const [selectedStudent, setSelectedStudent] = useState(null);
            const [showStudentModal, setShowStudentModal] = useState(false);
            
            const cls = classes.find(c => c.id === selectedClass);
            
            const generateReport = () => {
                if (!cls) return null;
                
                const start = new Date(startDate + 'T00:00:00');
                const end = new Date(endDate + 'T00:00:00');
                const days = [];
                
                for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                    days.push(d.toISOString().split('T')[0]);
                }
                
                return cls.students.filter(s => s.status === 'ativo').map(student => {
                    let presente = 0, falta = 0, justificada = 0;
                    
                    days.forEach(day => {
                        const att = student.attendance?.[day];
                        if (att === 'presente') presente++;
                        else if (att === 'falta') falta++;
                        else if (att === 'justificada') justificada++;
                    });
                    
                    const total = presente + falta + justificada;
                    const percentage = total > 0 ? ((presente / total) * 100).toFixed(1) : 0;
                    
                    return { student, presente, falta, justificada, total, percentage, days };
                });
            };
            
            const report = generateReport();
            
            // Fun√ß√£o para gerar PDF Individual
            const generateIndividualPDF = () => {
                if (!selectedStudent || !report) return;
                
                const studentData = report.find(r => r.student.id === selectedStudent);
                if (!studentData) return;
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // T√≠tulo
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('Relat√≥rio Individual de Frequ√™ncia', 105, 20, { align: 'center' });
                
                // Info da turma
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                doc.text(`Turma: ${cls.name}`, 20, 35);
                doc.text(`Per√≠odo: ${new Date(startDate + 'T00:00:00').toLocaleDateString('pt-BR')} a ${new Date(endDate + 'T00:00:00').toLocaleDateString('pt-BR')}`, 20, 42);
                
                // Nome do aluno
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text(`Aluno: ${studentData.student.name}`, 20, 55);
                
                // Estat√≠sticas
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                doc.text(`Presen√ßas: ${studentData.presente}`, 20, 70);
                doc.text(`Faltas: ${studentData.falta}`, 20, 77);
                doc.text(`Justificadas: ${studentData.justificada}`, 20, 84);
                doc.text(`Total de Aulas: ${studentData.total}`, 20, 91);
                doc.text(`Percentual de Presen√ßa: ${studentData.percentage}%`, 20, 98);
                
                // Status
                const status = parseFloat(studentData.percentage) >= 75 ? 'APROVADO' : 'REPROVADO por falta';
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text(`Situa√ß√£o: ${status}`, 20, 110);
                
                doc.save(`relatorio_${studentData.student.name.replace(/\s/g, '_')}.pdf`);
                showToast('PDF Individual gerado com sucesso!', 'success');
                setShowStudentModal(false);
            };
            
            // Fun√ß√£o para gerar PDF da Turma Completa
            const generateClassPDF = () => {
                if (!report) return;
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // T√≠tulo
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text('Relat√≥rio de Frequ√™ncia da Turma', 105, 15, { align: 'center' });
                
                // Info
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.text(`Turma: ${cls.name}`, 105, 23, { align: 'center' });
                doc.text(`Per√≠odo: ${new Date(startDate + 'T00:00:00').toLocaleDateString('pt-BR')} a ${new Date(endDate + 'T00:00:00').toLocaleDateString('pt-BR')}`, 105, 29, { align: 'center' });
                
                // Tabela
                const tableData = report.map((r, idx) => [
                    idx + 1,
                    r.student.name,
                    r.presente,
                    r.falta,
                    r.justificada,
                    r.total,
                    `${r.percentage}%`
                ]);
                
                doc.autoTable({
                    startY: 35,
                    head: [['#', 'Aluno', 'Presen√ßas', 'Faltas', 'Justificadas', 'Total', '% Presen√ßa']],
                    body: tableData,
                    theme: 'grid',
                    headStyles: { fillColor: [91, 95, 199], fontSize: 10, fontStyle: 'bold' },
                    styles: { fontSize: 9, cellPadding: 3 },
                    columnStyles: {
                        0: { cellWidth: 10 },
                        1: { cellWidth: 70 },
                        2: { cellWidth: 20, halign: 'center' },
                        3: { cellWidth: 20, halign: 'center' },
                        4: { cellWidth: 25, halign: 'center' },
                        5: { cellWidth: 20, halign: 'center' },
                        6: { cellWidth: 25, halign: 'center' }
                    }
                });
                
                // Totais
                const finalY = doc.lastAutoTable.finalY + 10;
                doc.setFontSize(10);
                doc.text(`Total de Presen√ßas: ${report.reduce((sum, r) => sum + r.presente, 0)}`, 20, finalY);
                doc.text(`Total de Faltas: ${report.reduce((sum, r) => sum + r.falta, 0)}`, 20, finalY + 6);
                doc.text(`Total de Justificadas: ${report.reduce((sum, r) => sum + r.justificada, 0)}`, 20, finalY + 12);
                
                doc.save(`relatorio_turma_${cls.name.replace(/\s/g, '_')}.pdf`);
                showToast('PDF da Turma gerado com sucesso!', 'success');
            };
            
            // Fun√ß√£o para gerar PDF por Per√≠odo
            const generatePeriodPDF = () => {
                if (!report) return;
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Calcular estat√≠sticas por semana/m√™s
                const start = new Date(startDate + 'T00:00:00');
                const end = new Date(endDate + 'T00:00:00');
                const diffDays = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
                
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text('Relat√≥rio de Frequ√™ncia por Per√≠odo', 105, 15, { align: 'center' });
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.text(`Turma: ${cls.name}`, 105, 23, { align: 'center' });
                doc.text(`Per√≠odo: ${diffDays + 1} dias (${new Date(startDate + 'T00:00:00').toLocaleDateString('pt-BR')} a ${new Date(endDate + 'T00:00:00').toLocaleDateString('pt-BR')})`, 105, 29, { align: 'center' });
                
                // Estat√≠sticas gerais
                const totalPresencas = report.reduce((sum, r) => sum + r.presente, 0);
                const totalFaltas = report.reduce((sum, r) => sum + r.falta, 0);
                const totalJustificadas = report.reduce((sum, r) => sum + r.justificada, 0);
                const totalAulas = report.reduce((sum, r) => sum + r.total, 0);
                const mediaPresenca = totalAulas > 0 ? ((totalPresencas / totalAulas) * 100).toFixed(1) : 0;
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Estat√≠sticas do Per√≠odo:', 20, 45);
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(11);
                doc.text(`Total de Presen√ßas: ${totalPresencas}`, 20, 55);
                doc.text(`Total de Faltas: ${totalFaltas}`, 20, 62);
                doc.text(`Total de Justificadas: ${totalJustificadas}`, 20, 69);
                doc.text(`M√©dia de Presen√ßa da Turma: ${mediaPresenca}%`, 20, 76);
                doc.text(`N√∫mero de Alunos Ativos: ${report.length}`, 20, 83);
                
                // Tabela resumida
                const tableData = report.map((r, idx) => [
                    idx + 1,
                    r.student.name,
                    `${r.percentage}%`,
                    parseFloat(r.percentage) >= 75 ? 'OK' : 'ATEN√á√ÉO'
                ]);
                
                doc.autoTable({
                    startY: 95,
                    head: [['#', 'Aluno', '% Presen√ßa', 'Status']],
                    body: tableData,
                    theme: 'grid',
                    headStyles: { fillColor: [255, 140, 0], fontSize: 10, fontStyle: 'bold' },
                    styles: { fontSize: 9, cellPadding: 3 },
                    columnStyles: {
                        0: { cellWidth: 15 },
                        1: { cellWidth: 100 },
                        2: { cellWidth: 30, halign: 'center' },
                        3: { cellWidth: 35, halign: 'center' }
                    }
                });
                
                doc.save(`relatorio_periodo_${cls.name.replace(/\s/g, '_')}.pdf`);
                showToast('PDF por Per√≠odo gerado com sucesso!', 'success');
            };
            
            // Fun√ß√£o para gerar PDF com Gr√°ficos
            const generateGraphPDF = () => {
                if (!report) return;
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text('Relat√≥rio com Estat√≠sticas Visuais', 105, 15, { align: 'center' });
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.text(`Turma: ${cls.name}`, 105, 23, { align: 'center' });
                doc.text(`Per√≠odo: ${new Date(startDate + 'T00:00:00').toLocaleDateString('pt-BR')} a ${new Date(endDate + 'T00:00:00').toLocaleDateString('pt-BR')}`, 105, 29, { align: 'center' });
                
                // Estat√≠sticas gerais
                const totalPresencas = report.reduce((sum, r) => sum + r.presente, 0);
                const totalFaltas = report.reduce((sum, r) => sum + r.falta, 0);
                const totalJustificadas = report.reduce((sum, r) => sum + r.justificada, 0);
                
                // Gr√°fico de pizza simulado (texto)
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('Distribui√ß√£o Geral:', 20, 45);
                
                const total = totalPresencas + totalFaltas + totalJustificadas;
                const percPresenca = total > 0 ? ((totalPresencas / total) * 100).toFixed(1) : 0;
                const percFalta = total > 0 ? ((totalFaltas / total) * 100).toFixed(1) : 0;
                const percJust = total > 0 ? ((totalJustificadas / total) * 100).toFixed(1) : 0;
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(0, 128, 0);
                doc.text(`Presen√ßas: ${totalPresencas} (${percPresenca}%)`, 20, 55);
                doc.setTextColor(255, 0, 0);
                doc.text(`Faltas: ${totalFaltas} (${percFalta}%)`, 20, 62);
                doc.setTextColor(255, 165, 0);
                doc.text(`Justificadas: ${totalJustificadas} (${percJust}%)`, 20, 69);
                
                doc.setTextColor(0, 0, 0);
                
                // Ranking de frequ√™ncia
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('Ranking de Frequ√™ncia:', 20, 85);
                
                const sorted = [...report].sort((a, b) => parseFloat(b.percentage) - parseFloat(a.percentage));
                const top5 = sorted.slice(0, 5);
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                top5.forEach((r, idx) => {
                    const medal = idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : idx === 2 ? 'ü•â' : '';
                    doc.text(`${idx + 1}. ${r.student.name}: ${r.percentage}% ${medal}`, 20, 95 + (idx * 7));
                });
                
                // Alunos em risco
                const emRisco = report.filter(r => parseFloat(r.percentage) < 75);
                if (emRisco.length > 0) {
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(255, 0, 0);
                    doc.text(`Alunos em Risco (< 75%): ${emRisco.length}`, 20, 135);
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    emRisco.slice(0, 5).forEach((r, idx) => {
                        doc.text(`‚Ä¢ ${r.student.name}: ${r.percentage}%`, 20, 145 + (idx * 7));
                    });
                }
                
                doc.setTextColor(0, 0, 0);
                
                doc.save(`relatorio_graficos_${cls.name.replace(/\s/g, '_')}.pdf`);
                showToast('PDF com Gr√°ficos gerado com sucesso!', 'success');
            };
            
            // Fun√ß√£o para gerar Folha de Presen√ßa
            const generateAttendanceSheet = () => {
                if (!cls) return;
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text('Folha de Presen√ßa', 105, 15, { align: 'center' });
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.text(`Turma: ${cls.name}`, 20, 25);
                doc.text(`Data: ___/___/_____`, 20, 32);
                doc.text(`Professor: _________________________________`, 20, 39);
                
                // Lista de alunos
                const activeStudents = cls.students.filter(s => s.status === 'ativo');
                const tableData = activeStudents.map((s, idx) => [
                    idx + 1,
                    s.name,
                    '',
                    ''
                ]);
                
                doc.autoTable({
                    startY: 50,
                    head: [['#', 'Nome do Aluno', 'Presente', 'Falta']],
                    body: tableData,
                    theme: 'grid',
                    headStyles: { fillColor: [0, 128, 128], fontSize: 11, fontStyle: 'bold' },
                    styles: { fontSize: 10, cellPadding: 5, minCellHeight: 12 },
                    columnStyles: {
                        0: { cellWidth: 15, halign: 'center' },
                        1: { cellWidth: 110 },
                        2: { cellWidth: 30, halign: 'center' },
                        3: { cellWidth: 25, halign: 'center' }
                    }
                });
                
                // Rodap√©
                const finalY = doc.lastAutoTable.finalY + 15;
                doc.setFontSize(9);
                doc.text('Assinatura do Professor: _________________________________', 20, finalY);
                doc.text(`Total de Alunos: ${activeStudents.length}`, 20, finalY + 10);
                
                doc.save(`folha_presenca_${cls.name.replace(/\s/g, '_')}.pdf`);
                showToast('Folha de Presen√ßa gerada com sucesso!', 'success');
            };
            
            const handlePrint = () => {
                window.print();
            };
            
            return (
                <div className="space-y-6">
                    <div className="bg-white p-6 rounded-xl shadow-lg no-print">
                        <h2 className="text-2xl font-bold mb-4">üìà Relat√≥rios de Frequ√™ncia</h2>
                        
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">üè´ Turma:</label>
                                <select value={selectedClass || ''} onChange={(e) => setSelectedClass(Number(e.target.value))}
                                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-indigo-500 outline-none">
                                    <option value="">-- Escolha uma turma --</option>
                                    {classes.map(c => (
                                        <option key={c.id} value={c.id}>{c.name}</option>
                                    ))}
                                </select>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">üìÖ Data In√≠cio:</label>
                                <input type="date" value={startDate} onChange={(e) => setStartDate(e.target.value)}
                                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-indigo-500 outline-none" />
                            </div>
                            
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">üìÖ Data Fim:</label>
                                <input type="date" value={endDate} onChange={(e) => setEndDate(e.target.value)}
                                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-indigo-500 outline-none" />
                            </div>
                        </div>
                        
                        {/* BOT√ïES DE PDF - Aparecem SOMENTE quando uma turma √© selecionada */}
                        {report && (
                            <div className="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl border-2 border-purple-200 mb-4 mt-4">
                                <h3 className="text-xl font-bold mb-4 text-purple-800">üìÑ Exportar para PDF</h3>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                    {/* Bot√£o 1 - Individual */}
                                    <button onClick={() => setShowStudentModal(true)} className="bg-blue-600 text-white px-6 py-4 rounded-lg font-bold hover:bg-blue-700 transition shadow-lg flex items-center justify-center gap-2">
                                        <span className="text-2xl">üë§</span>
                                        <div className="text-left">
                                            <div className="text-sm">Relat√≥rio</div>
                                            <div>Individual</div>
                                        </div>
                                    </button>

                                    {/* Bot√£o 2 - Turma Completa */}
                                    <button onClick={generateClassPDF} className="bg-green-600 text-white px-6 py-4 rounded-lg font-bold hover:bg-green-700 transition shadow-lg flex items-center justify-center gap-2">
                                        <span className="text-2xl">üë•</span>
                                        <div className="text-left">
                                            <div className="text-sm">Relat√≥rio</div>
                                            <div>Turma Completa</div>
                                        </div>
                                    </button>

                                    {/* Bot√£o 3 - Por Per√≠odo */}
                                    <button onClick={generatePeriodPDF} className="bg-orange-600 text-white px-6 py-4 rounded-lg font-bold hover:bg-orange-700 transition shadow-lg flex items-center justify-center gap-2">
                                        <span className="text-2xl">üìÖ</span>
                                        <div className="text-left">
                                            <div className="text-sm">Relat√≥rio</div>
                                            <div>Por Per√≠odo</div>
                                        </div>
                                    </button>

                                    {/* Bot√£o 4 - Com Gr√°ficos */}
                                    <button onClick={generateGraphPDF} className="bg-purple-600 text-white px-6 py-4 rounded-lg font-bold hover:bg-purple-700 transition shadow-lg flex items-center justify-center gap-2">
                                        <span className="text-2xl">üìä</span>
                                        <div className="text-left">
                                            <div className="text-sm">Relat√≥rio com</div>
                                            <div>Gr√°ficos</div>
                                        </div>
                                    </button>

                                    {/* Bot√£o 5 - Folha de Presen√ßa */}
                                    <button onClick={generateAttendanceSheet} className="bg-teal-600 text-white px-6 py-4 rounded-lg font-bold hover:bg-teal-700 transition shadow-lg flex items-center justify-center gap-2">
                                        <span className="text-2xl">üìã</span>
                                        <div className="text-left">
                                            <div className="text-sm">Folha de</div>
                                            <div>Presen√ßa</div>
                                        </div>
                                    </button>

                                    {/* Bot√£o 6 - Imprimir */}
                                    <button onClick={handlePrint} className="bg-indigo-600 text-white px-6 py-4 rounded-lg font-bold hover:bg-indigo-700 transition shadow-lg flex items-center justify-center gap-2">
                                        <span className="text-2xl">üñ®Ô∏è</span>
                                        <div className="text-left">
                                            <div className="text-sm">Imprimir</div>
                                            <div>Relat√≥rio</div>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    {/* Modal de sele√ß√£o de aluno para relat√≥rio individual */}
                    {showStudentModal && report && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl p-6 w-full max-w-md shadow-2xl">
                                <h3 className="text-xl font-bold mb-4">Selecione o Aluno</h3>
                                <div className="space-y-2 max-h-96 overflow-y-auto">
                                    {report.map(r => (
                                        <button
                                            key={r.student.id}
                                            onClick={() => {
                                                setSelectedStudent(r.student.id);
                                                generateIndividualPDF();
                                            }}
                                            className="w-full text-left p-3 border-2 rounded-lg hover:bg-blue-50 hover:border-blue-500 transition">
                                            <div className="font-bold">{r.student.name}</div>
                                            <div className="text-sm text-gray-600">Presen√ßa: {r.percentage}%</div>
                                        </button>
                                    ))}
                                </div>
                                <button onClick={() => setShowStudentModal(false)} className="w-full mt-4 bg-gray-200 py-3 rounded-lg font-bold hover:bg-gray-300 transition">
                                    ‚ùå Cancelar
                                </button>
                            </div>
                        </div>
                    )}
                    
                    {report ? (
                        <div className="bg-white p-6 rounded-xl shadow-lg">
                            <div className="text-center mb-6">
                                <h3 className="text-2xl font-bold">Relat√≥rio de Frequ√™ncia</h3>
                                <p className="text-gray-600 mt-2">{cls.name}</p>
                                <p className="text-sm text-gray-500">Per√≠odo: {new Date(startDate + 'T00:00:00').toLocaleDateString('pt-BR')} a {new Date(endDate + 'T00:00:00').toLocaleDateString('pt-BR')}</p>
                            </div>
                            
                            <div className="overflow-x-auto">
                                <table className="w-full border-collapse">
                                    <thead>
                                        <tr className="bg-indigo-600 text-white">
                                            <th className="border-2 border-indigo-700 p-3 text-left">#</th>
                                            <th className="border-2 border-indigo-700 p-3 text-left">Aluno</th>
                                            <th className="border-2 border-indigo-700 p-3 text-center">‚úÖ Presen√ßas</th>
                                            <th className="border-2 border-indigo-700 p-3 text-center">‚ùå Faltas</th>
                                            <th className="border-2 border-indigo-700 p-3 text-center">üìù Justificadas</th>
                                            <th className="border-2 border-indigo-700 p-3 text-center">üìä Total</th>
                                            <th className="border-2 border-indigo-700 p-3 text-center">% Presen√ßa</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {report.map((r, idx) => (
                                            <tr key={r.student.id} className="hover:bg-gray-50">
                                                <td className="border-2 p-3 font-bold">{idx + 1}</td>
                                                <td className="border-2 p-3 font-semibold">{r.student.name}</td>
                                                <td className="border-2 p-3 text-center text-green-600 font-bold">{r.presente}</td>
                                                <td className="border-2 p-3 text-center text-red-600 font-bold">{r.falta}</td>
                                                <td className="border-2 p-3 text-center text-yellow-600 font-bold">{r.justificada}</td>
                                                <td className="border-2 p-3 text-center font-bold">{r.total}</td>
                                                <td className="border-2 p-3 text-center">
                                                    <span className={`font-bold ${r.percentage >= 75 ? 'text-green-600' : 'text-red-600'}`}>
                                                        {r.percentage}%
                                                    </span>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div className="mt-6 text-sm text-gray-600">
                                <p>‚úÖ Total de Presen√ßas: {report.reduce((sum, r) => sum + r.presente, 0)}</p>
                                <p>‚ùå Total de Faltas: {report.reduce((sum, r) => sum + r.falta, 0)}</p>
                                <p>üìù Total de Justificadas: {report.reduce((sum, r) => sum + r.justificada, 0)}</p>
                            </div>
                        </div>
                    ) : (
                        <div className="bg-white p-12 rounded-xl shadow-lg text-center">
                            <div className="text-6xl mb-4">üìä</div>
                            <p className="text-xl text-gray-600">Selecione uma turma para gerar o relat√≥rio</p>
                        </div>
                    )}
                </div>
            );
        }
        
        function ConfigModal({ onClose, showToast }) {
            const [apiKey, setApiKey] = useState(CloudSync.getKey());
            const [binId, setBinId] = useState(CloudSync.getBinId());
            const [showAdvanced, setShowAdvanced] = useState(false);
            
            const handleSave = () => {
                if (apiKey.trim()) {
                    localStorage.setItem('jsonbin_api_key', apiKey.trim());
                    if (binId.trim()) {
                        localStorage.setItem('syncBinId', binId.trim());
                    }
                    showToast('Configura√ß√£o salva com sucesso!', 'success');
                    onClose();
                } else {
                    showToast('Digite uma chave v√°lida!', 'error');
                }
            };
            
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl p-6 w-full max-w-3xl max-h-[90vh] overflow-auto shadow-2xl">
                        <h2 className="text-2xl font-bold mb-4">‚öôÔ∏è Configura√ß√µes de Sincroniza√ß√£o</h2>
                        
                        <div className="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-lg mb-4 border-2 border-green-200">
                            <h3 className="font-bold mb-3 text-lg">üéØ CONFIGURA√á√ÉO COMPARTILHADA (RECOMENDADO)</h3>
                            <div className="bg-white p-4 rounded-lg mb-3 border-2 border-blue-300">
                                <p className="font-bold text-blue-700 mb-2">‚úÖ Para que TODOS acessem com o mesmo link:</p>
                                <ol className="list-decimal list-inside space-y-2 text-sm">
                                    <li>Abra o arquivo HTML em um editor de texto</li>
                                    <li>Procure por <code className="bg-gray-200 px-2 py-1 rounded">SHARED_CONFIG</code></li>
                                    <li>Cole sua API Key em <code className="bg-gray-200 px-2 py-1 rounded">apiKey: ''</code></li>
                                    <li>Ap√≥s a primeira sincroniza√ß√£o, o BIN ID aparecer√° no console do navegador</li>
                                    <li>Copie o BIN ID e cole em <code className="bg-gray-200 px-2 py-1 rounded">binId: ''</code></li>
                                    <li>Salve o arquivo e compartilhe com sua equipe!</li>
                                </ol>
                                <div className="mt-3 p-3 bg-yellow-100 rounded border border-yellow-300">
                                    <p className="text-sm"><strong>üí° Vantagem:</strong> Todos acessam os mesmos dados sem precisar configurar nada! Basta abrir o link.</p>
                                </div>
                            </div>
                        </div>
                        
                        <button 
                            onClick={() => setShowAdvanced(!showAdvanced)}
                            className="w-full mb-4 bg-gray-200 py-2 rounded-lg font-bold hover:bg-gray-300 transition">
                            {showAdvanced ? '‚ñº' : '‚ñ∂'} Configura√ß√£o Individual (Avan√ßado)
                        </button>
                        
                        {showAdvanced && (
                            <>
                                <div className="bg-blue-50 p-4 rounded-lg mb-4 border-2 border-blue-200">
                                    <h3 className="font-bold mb-2">üì° Configura√ß√£o Local (apenas este dispositivo)</h3>
                                    <ol className="list-decimal list-inside space-y-1 text-sm mb-3">
                                        <li>Acesse <a href="https://jsonbin.io" target="_blank" className="text-blue-600 underline">jsonbin.io</a></li>
                                        <li>Crie uma conta gratuita</li>
                                        <li>Copie sua API Key</li>
                                        <li>Cole abaixo</li>
                                    </ol>
                                </div>
                                
                                <div className="mb-4">
                                    <label className="block text-sm font-bold text-gray-700 mb-2">üîë Chave da API (JSONBin):</label>
                                    <input type="text" value={apiKey} onChange={(e) => setApiKey(e.target.value)}
                                        placeholder="Cole sua chave da API aqui..."
                                        className="w-full px-4 py-3 border-2 rounded-lg focus:border-indigo-500 outline-none font-mono text-sm" />
                                </div>
                                
                                <div className="mb-4">
                                    <label className="block text-sm font-bold text-gray-700 mb-2">üÜî BIN ID (opcional):</label>
                                    <input type="text" value={binId} onChange={(e) => setBinId(e.target.value)}
                                        placeholder="Cole o BIN ID para conectar a um banco existente..."
                                        className="w-full px-4 py-3 border-2 rounded-lg focus:border-indigo-500 outline-none font-mono text-sm" />
                                    <p className="text-xs text-gray-500 mt-1">Deixe vazio para criar um novo banco de dados</p>
                                </div>
                                
                                <div className="flex gap-2">
                                    <button onClick={handleSave} className="flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition">
                                        ‚úÖ Salvar
                                    </button>
                                    <button onClick={onClose} className="flex-1 bg-gray-200 py-3 rounded-lg font-bold hover:bg-gray-300 transition">
                                        ‚ùå Cancelar
                                    </button>
                                </div>
                            </>
                        )}
                        
                        {!showAdvanced && (
                            <button onClick={onClose} className="w-full bg-gray-200 py-3 rounded-lg font-bold hover:bg-gray-300 transition">
                                ‚ùå Fechar
                            </button>
                        )}
                    </div>
                </div>
            );
        }
        
        function UsersModal({ users, setUsers, onClose, showToast }) {
            const [login, setLogin] = useState('');
            const [password, setPassword] = useState('');
            const [name, setName] = useState('');
            const [role, setRole] = useState('viewer');
            const [editingUser, setEditingUser] = useState(null);
            const [newPassword, setNewPassword] = useState('');
            
            const handleAdd = () => {
                if (!login.trim() || !password.trim() || !name.trim()) {
                    showToast('Preencha todos os campos!', 'error');
                    return;
                }
                
                if (users[login]) {
                    showToast('Este login j√° existe!', 'error');
                    return;
                }
                
                setUsers({ ...users, [login]: { password, name, role } });
                showToast(`Usu√°rio ${name} criado! Aguarde a sincroniza√ß√£o...`, 'success');
                setLogin('');
                setPassword('');
                setName('');
                setRole('viewer');
                
                // For√ßa sincroniza√ß√£o imediata
                setTimeout(async () => {
                    if (CloudSync.getKey()) {
                        const result = await CloudSync.save({ classes, users: { ...users, [login]: { password, name, role } } });
                        if (result.success) {
                            showToast('Usu√°rio sincronizado com a nuvem!', 'success');
                        }
                    }
                }, 500);
            };
            
            const handleChangePassword = (userLogin) => {
                if (!newPassword.trim()) {
                    showToast('Digite a nova senha!', 'error');
                    return;
                }
                
                const updatedUsers = {
                    ...users,
                    [userLogin]: { ...users[userLogin], password: newPassword.trim() }
                };
                
                setUsers(updatedUsers);
                showToast(`Senha de ${users[userLogin].name} alterada! Aguarde a sincroniza√ß√£o...`, 'success');
                setEditingUser(null);
                setNewPassword('');
                
                // For√ßa sincroniza√ß√£o imediata
                setTimeout(async () => {
                    if (CloudSync.getKey()) {
                        const result = await CloudSync.save({ classes, users: updatedUsers });
                        if (result.success) {
                            showToast('Senha sincronizada com a nuvem!', 'success');
                        }
                    }
                }, 500);
            };
            
            const handleDelete = (userLogin) => {
                if (userLogin === 'admin') {
                    showToast('N√£o √© poss√≠vel excluir o administrador principal!', 'error');
                    return;
                }
                
                if (confirm(`‚ö†Ô∏è Excluir o usu√°rio "${users[userLogin].name}"?`)) {
                    const newUsers = { ...users };
                    delete newUsers[userLogin];
                    setUsers(newUsers);
                    showToast('Usu√°rio exclu√≠do com sucesso!', 'success');
                }
            };
            
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl p-6 w-full max-w-3xl max-h-[90vh] overflow-auto shadow-2xl">
                        <h2 className="text-2xl font-bold mb-4">üë• Gerenciar Usu√°rios</h2>
                        
                        <div className="bg-green-50 p-4 rounded-lg mb-4 border-2 border-green-200">
                            <h3 className="font-bold mb-3">‚ûï Criar Novo Usu√°rio</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                <input value={login} onChange={(e) => setLogin(e.target.value)}
                                    placeholder="Login (usu√°rio)" 
                                    className="px-4 py-3 border-2 rounded-lg focus:border-green-500 outline-none" />
                                <input value={password} onChange={(e) => setPassword(e.target.value)}
                                    type="password"
                                    placeholder="Senha" 
                                    className="px-4 py-3 border-2 rounded-lg focus:border-green-500 outline-none" />
                                <input value={name} onChange={(e) => setName(e.target.value)}
                                    placeholder="Nome completo" 
                                    className="px-4 py-3 border-2 rounded-lg focus:border-green-500 outline-none" />
                                <select value={role} onChange={(e) => setRole(e.target.value)}
                                    className="px-4 py-3 border-2 rounded-lg focus:border-green-500 outline-none bg-white">
                                    <option value="admin">üëë Administrador</option>
                                    <option value="editor">‚úèÔ∏è Editor</option>
                                    <option value="viewer">üëÅÔ∏è Visualizador</option>
                                </select>
                            </div>
                            <button onClick={handleAdd} className="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition">
                                ‚úÖ Criar Usu√°rio
                            </button>
                        </div>
                        
                        <div className="space-y-2">
                            <h3 className="font-bold mb-2">üìã Usu√°rios Cadastrados:</h3>
                            {Object.entries(users).map(([userLogin, userData]) => (
                                <div key={userLogin} className="border-2 rounded-lg p-4 bg-white hover:bg-gray-50 transition">
                                    <div className="flex items-center gap-3 mb-3">
                                        <div className="flex-1">
                                            <p className="font-bold text-lg">{userData.name}</p>
                                            <p className="text-sm text-gray-600">Login: {userLogin} | Fun√ß√£o: {userData.role === 'admin' ? 'üëë Admin' : userData.role === 'editor' ? '‚úèÔ∏è Editor' : 'üëÅÔ∏è Visualizador'}</p>
                                        </div>
                                        <button 
                                            onClick={() => setEditingUser(editingUser === userLogin ? null : userLogin)}
                                            className="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">
                                            üîë {editingUser === userLogin ? 'Cancelar' : 'Alterar Senha'}
                                        </button>
                                        {userLogin !== 'admin' && (
                                            <button onClick={() => handleDelete(userLogin)} 
                                                className="text-red-600 px-4 py-2 hover:bg-red-50 rounded-lg font-semibold transition">
                                                üóëÔ∏è Excluir
                                            </button>
                                        )}
                                    </div>
                                    
                                    {editingUser === userLogin && (
                                        <div className="bg-yellow-50 p-3 rounded-lg border-2 border-yellow-200">
                                            <h4 className="font-bold mb-2 text-sm">üîë Alterar Senha de {userData.name}</h4>
                                            <div className="flex gap-2">
                                                <input 
                                                    type="password"
                                                    value={newPassword}
                                                    onChange={(e) => setNewPassword(e.target.value)}
                                                    placeholder="Digite a nova senha"
                                                    className="flex-1 px-4 py-2 border-2 rounded-lg focus:border-yellow-500 outline-none"
                                                    onKeyPress={(e) => e.key === 'Enter' && handleChangePassword(userLogin)}
                                                />
                                                <button 
                                                    onClick={() => handleChangePassword(userLogin)}
                                                    className="bg-yellow-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-yellow-700 transition">
                                                    ‚úÖ Salvar
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                        
                        <button onClick={onClose} className="w-full mt-4 bg-gray-200 py-3 rounded-lg font-bold hover:bg-gray-300 transition">
                            ‚ùå Fechar
                        </button>
                    </div>
                </div>
            );
        }
        
        function ClassesModal({ classes, setClasses, onClose, showToast }) {
            const [name, setName] = useState('');
            
            const handleAdd = () => {
                if (!name.trim()) {
                    showToast('Digite o nome da turma!', 'error');
                    return;
                }
                
                const newClass = {
                    id: Date.now(),
                    name: name.trim(),
                    students: []
                };
                
                setClasses([...classes, newClass]);
                showToast(`Turma "${name.trim()}" criada com sucesso!`, 'success');
                setName('');
            };
            
            const handleDelete = (id) => {
                const cls = classes.find(c => c.id === id);
                if (confirm(`‚ö†Ô∏è Excluir a turma "${cls.name}"? Todos os dados ser√£o perdidos!`)) {
                    setClasses(classes.filter(c => c.id !== id));
                    showToast('Turma exclu√≠da com sucesso!', 'success');
                }
            };
            
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl p-6 w-full max-w-2xl shadow-2xl">
                        <h2 className="text-2xl font-bold mb-4">üè´ Gerenciar Turmas</h2>
                        
                        <div className="bg-green-50 p-4 rounded-lg mb-4 border-2 border-green-200">
                            <h3 className="font-bold mb-3">‚ûï Criar Nova Turma</h3>
                            <div className="flex gap-2">
                                <input value={name} onChange={(e) => setName(e.target.value)}
                                    placeholder="Nome da turma (ex: 5¬∫ Ano A)" 
                                    className="flex-1 px-4 py-3 border-2 rounded-lg focus:border-green-500 outline-none"
                                    onKeyPress={(e) => e.key === 'Enter' && handleAdd()} />
                                <button onClick={handleAdd} className="bg-green-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-green-700 transition">
                                    ‚úÖ Criar
                                </button>
                            </div>
                        </div>
                        
                        <div className="space-y-2">
                            <h3 className="font-bold mb-2">üìã Turmas Cadastradas:</h3>
                            {classes.length === 0 ? (
                                <p className="text-gray-500 text-center py-4">Nenhuma turma cadastrada</p>
                            ) : (
                                classes.map(c => (
                                    <div key={c.id} className="flex items-center gap-3 p-4 border-2 rounded-lg bg-white hover:bg-gray-50 transition">
                                        <div className="flex-1">
                                            <p className="font-bold text-lg">{c.name}</p>
                                            <p className="text-sm text-gray-600">{c.students.length} aluno(s)</p>
                                        </div>
                                        <button onClick={() => handleDelete(c.id)} 
                                            className="text-red-600 px-4 py-2 hover:bg-red-50 rounded-lg font-semibold transition">
                                            üóëÔ∏è Excluir
                                        </button>
                                    </div>
                                ))
                            )}
                        </div>
                        
                        <button onClick={onClose} className="w-full mt-4 bg-gray-200 py-3 rounded-lg font-bold hover:bg-gray-300 transition">
                            ‚ùå Fechar
                        </button>
                    </div>
                </div>
            );
        }
        
        function StudentsModal({ class: cls, classes, setClasses, onClose, showToast }) {
            const [name, setName] = useState('');
            const [bulkInput, setBulkInput] = useState('');
            const [showBulkAdd, setShowBulkAdd] = useState(false);
            
            const handleAdd = () => {
                if (!name.trim()) {
                    showToast('Digite o nome do aluno!', 'error');
                    return;
                }
                
                const newStudent = {
                    id: Date.now(),
                    name: name.trim(),
                    status: 'ativo',
                    attendance: {},
                    observations: {}
                };
                
                setClasses(classes.map(c => 
                    c.id === cls.id 
                        ? { ...c, students: [...c.students, newStudent] }
                        : c
                ));
                
                showToast('Aluno adicionado com sucesso!', 'success');
                setName('');
            };
            
            const handleBulkAdd = () => {
                if (!bulkInput.trim()) {
                    showToast('Cole a lista de alunos!', 'error');
                    return;
                }
                
                // Divide por linhas e limpa espa√ßos
                const lines = bulkInput.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                
                if (lines.length === 0) {
                    showToast('Nenhum nome v√°lido encontrado!', 'error');
                    return;
                }
                
                const newStudents = lines.map((studentName, index) => ({
                    id: Date.now() + index,
                    name: studentName,
                    status: 'ativo',
                    attendance: {},
                    observations: {}
                }));
                
                setClasses(classes.map(c => 
                    c.id === cls.id 
                        ? { ...c, students: [...c.students, ...newStudents] }
                        : c
                ));
                
                showToast(`${newStudents.length} aluno(s) adicionado(s) com sucesso!`, 'success');
                setBulkInput('');
                setShowBulkAdd(false);
            };
            
            const handleStatusChange = (studentId, newStatus) => {
                setClasses(classes.map(c =>
                    c.id === cls.id
                        ? { ...c, students: c.students.map(s => 
                            s.id === studentId ? { ...s, status: newStatus } : s
                        )}
                        : c
                ));
            };
            
            const handleDelete = (studentId) => {
                const student = cls.students.find(s => s.id === studentId);
                if (confirm(`‚ö†Ô∏è Excluir o aluno "${student.name}"? Todos os registros ser√£o perdidos!`)) {
                    setClasses(classes.map(c =>
                        c.id === cls.id
                            ? { ...c, students: c.students.filter(s => s.id !== studentId) }
                            : c
                    ));
                    showToast('Aluno exclu√≠do com sucesso!', 'success');
                }
            };
            
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl p-6 w-full max-w-3xl max-h-[90vh] overflow-auto shadow-2xl">
                        <h2 className="text-2xl font-bold mb-4">üë®‚Äçüéì Gerenciar Alunos - {cls.name}</h2>
                        
                        <div className="flex gap-2 mb-4">
                            <button 
                                onClick={() => setShowBulkAdd(false)}
                                className={`flex-1 py-2 rounded-lg font-bold transition ${!showBulkAdd ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}>
                                ‚ûï Adicionar Individual
                            </button>
                            <button 
                                onClick={() => setShowBulkAdd(true)}
                                className={`flex-1 py-2 rounded-lg font-bold transition ${showBulkAdd ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}>
                                üìã Adicionar V√°rios
                            </button>
                        </div>
                        
                        {!showBulkAdd ? (
                            <div className="bg-blue-50 p-4 rounded-lg mb-4 border-2 border-blue-200">
                                <h3 className="font-bold mb-3">‚ûï Adicionar Novo Aluno</h3>
                                <div className="flex gap-2">
                                    <input value={name} onChange={(e) => setName(e.target.value)}
                                        placeholder="Nome completo do aluno" 
                                        className="flex-1 px-4 py-3 border-2 rounded-lg focus:border-blue-500 outline-none" 
                                        onKeyPress={(e) => e.key === 'Enter' && handleAdd()} />
                                    <button onClick={handleAdd} className="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-blue-700 transition">
                                        ‚úÖ Adicionar
                                    </button>
                                </div>
                            </div>
                        ) : (
                            <div className="bg-purple-50 p-4 rounded-lg mb-4 border-2 border-purple-200">
                                <h3 className="font-bold mb-3">üìã Adicionar V√°rios Alunos de Uma Vez</h3>
                                <p className="text-sm text-gray-600 mb-3">Cole a lista de alunos abaixo (um nome por linha):</p>
                                <textarea 
                                    value={bulkInput} 
                                    onChange={(e) => setBulkInput(e.target.value)}
                                    placeholder="Jo√£o Silva&#10;Maria Santos&#10;Pedro Oliveira&#10;Ana Costa"
                                    className="w-full px-4 py-3 border-2 rounded-lg focus:border-purple-500 outline-none resize-none font-mono text-sm"
                                    rows="8"
                                />
                                <button onClick={handleBulkAdd} className="w-full mt-3 bg-purple-600 text-white py-3 rounded-lg font-bold hover:bg-purple-700 transition">
                                    ‚úÖ Adicionar Todos os Alunos
                                </button>
                            </div>
                        )}
                        
                        <div className="space-y-2">
                            <h3 className="font-bold mb-2">üìã Alunos da Turma ({cls.students.length}):</h3>
                            {cls.students.length === 0 ? (
                                <p className="text-gray-500 text-center py-4">Nenhum aluno cadastrado</p>
                            ) : (
                                cls.students.map(s => (
                                    <div key={s.id} className="flex items-center gap-3 p-4 border-2 rounded-lg bg-white hover:bg-gray-50 transition">
                                        <span className="flex-1 font-bold text-lg">{s.name}</span>
                                        <select value={s.status} 
                                            onChange={(e) => handleStatusChange(s.id, e.target.value)}
                                            className="px-4 py-2 border-2 rounded-lg focus:border-indigo-500 outline-none bg-white">
                                            <option value="ativo">‚úÖ Ativo</option>
                                            <option value="transferido">üîÑ Transferido</option>
                                            <option value="falecido">üïäÔ∏è Falecido</option>
                                        </select>
                                        <button onClick={() => handleDelete(s.id)} 
                                            className="text-red-600 px-4 py-2 hover:bg-red-50 rounded-lg font-semibold transition">
                                            üóëÔ∏è Excluir
                                        </button>
                                    </div>
                                ))
                            )}
                        </div>
                        
                        <button onClick={onClose} className="w-full mt-4 bg-gray-200 py-3 rounded-lg font-bold hover:bg-gray-300 transition">
                            ‚ùå Fechar
                        </button>
                    </div>
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
